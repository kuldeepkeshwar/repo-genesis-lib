#!/usr/bin/env node
!function(e,r){for(var t in r)e[t]=r[t]}(exports,function(e){var r={};function t(n){if(r[n])return r[n].exports;var u=r[n]={i:n,l:!1,exports:{}};return e[n].call(u.exports,u,u.exports,t),u.l=!0,u.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var u in e)t.d(n,u,function(r){return e[r]}.bind(null,u));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=6)}([function(e,r){e.exports=require("@babel/runtime/helpers/interopRequireDefault")},function(e,r){e.exports=require("@babel/runtime/regenerator")},function(e,r){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,r){e.exports=require("@sindresorhus/is")},function(e,r){e.exports=require("tacker")},function(e,r){function t(e){var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}t.keys=function(){return[]},t.resolve=t,e.exports=t,t.id=5},function(e,r,t){e.exports=t(7)},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"parse",{enumerable:!0,get:function(){return n.parse}}),Object.defineProperty(r,"chooseConfig",{enumerable:!0,get:function(){return n.chooseConfig}}),Object.defineProperty(r,"parseConfig",{enumerable:!0,get:function(){return n.parseConfig}}),Object.defineProperty(r,"modernizeOldConfig",{enumerable:!0,get:function(){return n.modernizeOldConfig}}),Object.defineProperty(r,"readConfig",{enumerable:!0,get:function(){return n.readConfig}}),Object.defineProperty(r,"generate",{enumerable:!0,get:function(){return u.generate}}),Object.defineProperty(r,"genAll",{enumerable:!0,get:function(){return u.genAll}}),Object.defineProperty(r,"genRepository",{enumerable:!0,get:function(){return u.genRepository}}),Object.defineProperty(r,"genSymlink",{enumerable:!0,get:function(){return u.genSymlink}}),Object.defineProperty(r,"genDependency",{enumerable:!0,get:function(){return u.genDependency}});var n=t(8),u=t(15)},function(e,r,t){"use strict";var n=t(0);Object.defineProperty(r,"__esModule",{value:!0}),r.parse=function(e){return b.apply(this,arguments)},r.chooseConfig=h,r.modernizeOldConfig=v,r.readConfig=y,r.parseConfig=k,r.parseNewRepoFormat=O,r.parseOldRepoFormat=w,r.printTransformedConfig=function(e){var r=e.repoRemoteUri,t=e.symPath,n=e.repoPath;(0,l.printMirror)({repoRemoteUri:r},"magenta","grey"),(0,l.printMirror)({symPath:t},"magenta","grey"),(0,l.printMirror)({repoPath:n},"magenta","grey")},r.getTransformedConfig=j;var u=n(t(1)),a=n(t(9)),o=n(t(2)),i=n(t(10)),s=n(t(11)),c=n(t(12)),f=n(t(3)),p=t(13),l=t(4),d=t(14),g=console.log;function b(){return(b=(0,o.default)(u.default.mark(function e(r){var t,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!f.default.nullOrUndefined(r)){e.next=7;break}return e.next=3,h();case 3:return t=e.sent,e.abrupt("return",k(t[0]));case 7:if(!f.default.string(r)){e.next=18;break}if(!r.endsWith(".json")&&!myConfig.endsWidth(".js")){e.next=15;break}return e.next=11,y(r);case 11:return n=e.sent,e.abrupt("return",k(n));case 15:return e.abrupt("return",(0,l.printError)(!0,{fn:"parse",msg:"Unrecognized file type to parse. Expecting ".concat(c.default.underline(".js")," or ").concat(c.default.underline(".json"))}));case 16:e.next=23;break;case 18:if(!f.default.object(r)){e.next=22;break}return e.abrupt("return",k(r));case 22:(0,l.printError)(!0,{fn:"parse",msg:"Need to provide either a config object or path to a config file"});case 23:case"end":return e.stop()}},e)}))).apply(this,arguments)}function h(){return x.apply(this,arguments)}function x(){return(x=(0,o.default)(u.default.mark(function e(){var r,n,a,o,i,c,g,b=arguments;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=b.length>0&&void 0!==b[0]?b[0]:void 0,!f.default.nullOrUndefined(r)){e.next=47;break}if(n=process.env.rgConfigPath,a=s.default.join(process.cwd(),".repogen.json"),!f.default.nullOrUndefined(n)){e.next=40;break}return e.next=7,(0,p.pathsExist)(a);case 7:if(e.t0=e.sent,!1!==e.t0){e.next=34;break}return e.next=11,(0,d.getPkgProp)("repogen");case 11:return o=e.sent,(0,l.printMirror)({repogenPkg:o},"yellow","red"),e.next=15,(0,d.getPkgProp)("repogen");case 15:if(e.t1=e.sent,!1!==e.t1){e.next=28;break}return i=s.default.join(process.cwd(),".repogen.js"),e.next=20,(0,p.pathsExist)(i);case 20:if(!e.sent){e.next=25;break}return c=t(5)(i),g=c.config,e.abrupt("return",[v(g),".repogen.js"]);case 25:return e.abrupt("return",(0,l.printError)({fn:"await pathsExist(repogenJsPath)",msg:"Path didn't exist or there was an error with require()"}));case 26:e.next=32;break;case 28:return e.next=30,(0,d.getPkgProp)("repogen");case 30:return e.t2=e.sent,e.abrupt("return",[e.t2,"package.json"]);case 32:e.next=38;break;case 34:return e.next=36,y(a);case 36:return e.t3=e.sent,e.abrupt("return",[e.t3,".repogen.json"]);case 38:e.next=45;break;case 40:return e.next=42,y(n);case 42:return e.t4=e.sent,e.t5=n,e.abrupt("return",[e.t4,e.t5]);case 45:e.next=52;break;case 47:if(!r.hasOwnProperty("repositories")){e.next=51;break}return e.abrupt("return",[v(r),".repogen.js"]);case 51:return e.abrupt("return",[r,".repogen.json"]);case 52:case"end":return e.stop()}},e)}))).apply(this,arguments)}function v(e){for(var r={},t=0,n=Object.entries(e);t<n.length;t++){var u=(0,a.default)(n[t],2),o=u[0],i=u[1];"provider"===o&&(process.env.rgAuthHost=i),"repospacePath"===o&&Object.assign(r,{dir:i}),"repositories"===o&&Object.assign(r,{repos:i})}return!1===r.hasOwnProperty("dir")&&Object.assign(r,{dir:""}),r}function y(e){return m.apply(this,arguments)}function m(){return(m=(0,o.default)(u.default.mark(function e(r){var n,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,p.pathsExist)(r);case 2:if(!e.sent){e.next=18;break}if(!r.endsWith(".json")){e.next=9;break}return e.next=6,i.default.readJson(r);case 6:return e.abrupt("return",e.sent);case 9:if(!r.endsWith(".js")){e.next=16;break}if(n=t(5)(r),a=n.config,!f.default.nullOrUndefined(a)){e.next=15;break}return e.abrupt("return",(0,l.printError)(!0,{fn:"readConfig()->require()",msg:"Does your repogen.js config export a config object?"}));case 15:return e.abrupt("return",a);case 16:e.next=19;break;case 18:return e.abrupt("return",(0,l.printError)(!0,{fn:"readConfig()",msg:"Specified config file path doesn't exist:\n ".concat(c.default.underline(r))}));case 19:case"end":return e.stop()}},e)}))).apply(this,arguments)}function k(e){if(f.default.nullOrUndefined(e))return null;if(e.hasOwnProperty("dir"))var r=e.dir;else r=".";var t=s.default.join(process.cwd(),r);process.env.rgRootDir=t;var n=s.default.join(t,".repositories");return process.env.rgRepoRootDir=n,(0,o.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.default.ensureDir(n).catch(function(e){return(0,l.printError)(!0,{fn:"parseConfig -> await fs.ensureDir",err:e,msg:"Directory could not be corrected"})});case 2:case"end":return e.stop()}},e)}))(),e.hasOwnProperty("repos")?e.repos.map(function(e){return Object.keys(e).length>1?O(e,t):w("github.com",e,t)}):e.hasOwnProperty("repositories")?e.repositories.map(function(e){return w("github.com",e,t)}):void 0}function O(e,r){if(f.default.nullOrUndefined(e)||f.default.nullOrUndefined(r))return null;var t=e.plat,n=void 0===t?"github.com":t,u=e.space,a=e.repo,o=e.dir,i=void 0===o?"":o,s=e.sym,c=void 0===s?a:s;return f.default.nullOrUndefined(u)||f.default.nullOrUndefined(a)?null:Object.keys(e).length>1?j(n,u,a,r,i,c):void(0,l.printError)(!0,{fn:"parseNewRepoFormat",msg:"parseNewRepoFormat was called against an old repo format"})}function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"github.com",r=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(f.default.nullOrUndefined(r)||f.default.nullOrUndefined(t))return null;var u=Object.keys(r),a=r[u];return j(e,u,a,t,n,a)}function j(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"github.com",r=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t;return{repoRemoteUri:function(e,r,t){(f.default.nullOrUndefined(e)||f.default.nullOrUndefined(r)||f.default.nullOrUndefined(t))&&g("process.env.rgAuthHost: ".concat(c.default.red(process.env.rgAuthHost)));return f.default.nullOrUndefined(process.env.rgAuthHost)?"https://".concat(e,"/").concat(r,"/").concat(t):"git@".concat(process.env.rgAuthHost,":").concat(r,"/").concat(t)}(e,r,t),symPath:function(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(f.default.nullOrUndefined(e))return null;var n=s.default.join(r,t);return(0,o.default)(u.default.mark(function e(){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.default.ensureDir(n).catch(function(e){return(0,l.printError)(!0,{fn:"getSymlinkPath -> await fs.ensureDir",err:e,msg:"Directory could not be created"})});case 2:case"end":return e.stop()}},e)}))(),s.default.join(n,e)}(p,n,a),repoPath:function(e,r){return f.default.nullOrUndefined(r)?null:s.default.join(e,".repositories",r)}(n,t)}}},function(e,r){e.exports=require("@babel/runtime/helpers/slicedToArray")},function(e,r){e.exports=require("fs-extra")},function(e,r){e.exports=require("path")},function(e,r){e.exports=require("chalk")},function(e,r){e.exports=require("paths-exist")},function(e,r){e.exports=require("get-pkg-prop")},function(e,r,t){"use strict";var n=t(0);Object.defineProperty(r,"__esModule",{value:!0}),r.generate=function(e,r){return c.apply(this,arguments)},r.genAll=f,r.genRepository=l,r.genSymlink=b,r.genDependency=x,r.cloneRepositories=function(e){return k.apply(this,arguments)};var u=n(t(1)),a=n(t(2)),o=n(t(16)),i=n(t(17)),s=(t(4),n(t(3)));console.log;function c(){return(c=(0,a.default)(u.default.mark(function e(r,t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,e.t0=t,e.next="all"===e.t0?4:"repositories"===e.t0?7:"symlinks"===e.t0?10:"dependencies"===e.t0?13:16;break;case 4:return e.next=6,f(r);case 6:return e.abrupt("return",e.sent);case 7:return e.next=9,genRepositories(r);case 9:return e.abrupt("return",e.sent);case 10:return e.next=12,genSymlinks(r);case 12:return e.abrupt("return",e.sent);case 13:return e.next=15,genDependencies(r);case 15:return e.abrupt("return",e.sent);case 16:e.next=21;break;case 18:return e.prev=18,e.t1=e.catch(0),e.abrupt("return",new Error(e.t1));case 21:case"end":return e.stop()}},e,null,[[0,18]])}))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=(0,a.default)(u.default.mark(function e(r){var t,n,a,i,s,c,f,p,d,g;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t=!0,n=!1,e.prev=3,i=(0,o.default)(r);case 5:return e.next=7,i.next();case 7:return s=e.sent,t=s.done,e.next=11,s.value;case 11:if(c=e.sent,t){e.next=20;break}return p=(f=c).repoRemoteUri,d=f.symPath,g=f.repoPath,e.next=17,Promise.all([l(p),b(g,d),x(g)]);case 17:t=!0,e.next=5;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(3),n=!0,a=e.t0;case 26:if(e.prev=26,e.prev=27,t||null==i.return){e.next=31;break}return e.next=31,i.return();case 31:if(e.prev=31,!n){e.next=34;break}throw a;case 34:return e.finish(31);case 35:return e.finish(26);case 36:return e.abrupt("return",!0);case 39:return e.prev=39,e.t1=e.catch(0),e.abrupt("return",new Error(e.t1));case 42:case"end":return e.stop()}},e,null,[[0,39],[3,22,26,36],[27,,31,35]])}))).apply(this,arguments)}function l(e){return d.apply(this,arguments)}function d(){return(d=(0,a.default)(u.default.mark(function e(r){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y(r);case 3:e.next=8;break;case 5:return e.prev=5,e.t0=e.catch(0),e.abrupt("return",new Error(e.t0));case 8:case"end":return e.stop()}},e,null,[[0,5]])}))).apply(this,arguments)}function g(e,r){return e.substring(e.lastIndexOf(r)+1,e.length)}function b(e,r){return h.apply(this,arguments)}function h(){return(h=(0,a.default)(u.default.mark(function e(r,t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s.default.nullOrUndefined(t)?g(r,"/"):g(t,"/"),e.prev=1,e.next=4,(0,i.default)("ln",["-s",r,t]);case 4:e.next=9;break;case 6:return e.prev=6,e.t0=e.catch(1),e.abrupt("return",new Error(e.t0));case 9:case"end":return e.stop()}},e,null,[[1,6]])}))).apply(this,arguments)}function x(e){return v.apply(this,arguments)}function v(){return(v=(0,a.default)(u.default.mark(function e(r){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,i.default)("npm",["install"],{cwd:r});case 3:return e.abrupt("return",!0);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",new Error(e.t0));case 9:case"end":return e.stop()}},e,null,[[0,6]])}))).apply(this,arguments)}function y(e){return m.apply(this,arguments)}function m(){return(m=(0,a.default)(u.default.mark(function e(r){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.default)("git",["clone",r],{cwd:process.env.rgRepoRootDir});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}))).apply(this,arguments)}function k(){return(k=(0,a.default)(u.default.mark(function e(r){var t,n,a,i,s,c,f,p;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t={},n=!0,a=!1,e.prev=3,s=(0,o.default)(r);case 5:return e.next=7,s.next();case 7:return c=e.sent,n=c.done,e.next=11,c.value;case 11:if(f=e.sent,n){e.next=26;break}return p=f,e.prev=14,e.next=17,y(p);case 17:Object.assign(t,{uri:!0}),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(14),Object.assign(t,{uri:[!1,e.t0]});case 23:n=!0,e.next=5;break;case 26:e.next=32;break;case 28:e.prev=28,e.t1=e.catch(3),a=!0,i=e.t1;case 32:if(e.prev=32,e.prev=33,n||null==s.return){e.next=37;break}return e.next=37,s.return();case 37:if(e.prev=37,!a){e.next=40;break}throw i;case 40:return e.finish(37);case 41:return e.finish(32);case 42:case"end":return e.stop()}},e,null,[[3,28,32,42],[14,20],[33,,37,41]])}))).apply(this,arguments)}},function(e,r){e.exports=require("@babel/runtime/helpers/asyncIterator")},function(e,r){e.exports=require("execa")}]));
//# sourceMappingURL=main.js.map